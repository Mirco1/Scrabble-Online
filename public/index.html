<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Scrabble Online</title>
      	<script src="js/functions.js" type="text/javascript"></script>
      	<script src="http://code.jquery.com/jquery.min.js" type="text/javascript"></script>
      	

        <style>
        	body {
        		background-color: #ffffff;
        		font-family: Tahoma, Arial;
        		font-size:15px;
        	}
        	#wrap {
        		margin:0 auto;
        		width:950px;
        	}
        	#table td {
        		border:1px solid #333333;
        		padding:10px 10px 10px 10px;
        		height:10px;
        		width:10px;
        	}
        	#table {
        		border:1px solid #333333;
        		text-align:center;
        		margin-right: 10px;
        	}
        	#joc {
        		float:left;
        		width:530px;
        		margin-right: 10px;
        	}
        	#player1 {
        		float:left;
        		width:200px;
        		margin-right: 10px;
        	}
        	#player2 {
        		float:left;
        		width:200px;
        	}
        </style>
    </head>
    <body>
        <script>
            
            Array.prototype.remove = function(from, to) {
                var rest = this.slice((to || from) + 1 || this.length);
                this.length = from < 0 ? this.length + from : from;
                return this.push.apply(this, rest);
            };

            var saculetculitere = ["A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "B", "B",
                                    "C", "C", "C", "C", "C", "D", "D", "D", "D", "E", "E", "E", "E",
                                    "E", "E", "E", "E", "E", "F", "F", "G", "G", "H", "I", "I", "I",
                                    "I", "I", "I", "I", "I", "I", "I", "J", "L", "L", "L", "L", "M",
                                    "M", "M", "N", "N", "N", "N", "N", "N", "O", "O", "O", "O", "O",
                                    "P", "P", "P", "P", "R", "R", "R", "R", "R", "R", "R", "S", "S",
                                    "S", "S", "S", "T", "T", "T", "T", "T", "T", "T", "U", "U", "U",
                                    "U", "U", "U", "V", "V", "X", "Z"];
            var litereramaseinsac = 98;
            var playerturn = 1;
            var cuvintedepetabela = [];
            var gamewon = 0;
        </script>

	    <div id="wrap">
		    <div id="player1">
		    	<h3>Player 1</h3>
		    	<div id="letters_player1">
		    		<div id="lp11"></div>
		    		<div id="lp12"></div>
		    		<div id="lp13"></div>
		    		<div id="lp14"></div>
		    		<div id="lp15"></div>
                    <div id="lp16"></div>
                    <div id="lp17"></div>
		    	</div>
                <br>
                <div id="punctaj_player1">0</div>
		    </div>
	    	<div id="joc">
		        <script>
					var table_size = 16;
					var style = '';
					var seccond_diag = 16;
					var letter = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
					document.write('<table id="table" border="0" style="" cellpadding="0" cellspacing="0">');
					for(var i = 1; i < table_size; i++){ 
						document.write('<tr id="r' + i + '">');
						for(var j = 1; j < table_size; j++){
							do_colors();
							document.write('<td id="c'+ i + j +'" style="' + style + '"></td>');
							style = '';
						}
						document.write("</tr>");
					}
					document.write("</table>");
		        </script>
		    </div>

		    <div id="player2">
		    	<h3>Player 2</h3>
                <div id="letters_player2">
                    <div id="lp21"></div>
                    <div id="lp22"></div>
                    <div id="lp23"></div>
                    <div id="lp24"></div>
                    <div id="lp25"></div>
                    <div id="lp26"></div>
                    <div id="lp27"></div>
                </div>
		    </div>
            <br>
            <br>
            <br>
            <div id="punctaj_player2">0</div>
		    <br style="clear:both;">
   		</div>
        <script>
            function randomlettersofdoom(player){ //functie pentru adaugare de litere random pe placuta cu litere a jucatorilor; player poate fi 1 sau 2
                if (litereramaseinsac != 0) {
                    var i;
                    for (i = 1; i < 8; i++) {
                        if (litereramaseinsac == 0)
                            break;
                        var rand = Math.floor(Math.random()*litereramaseinsac);
                        console.log(rand);
                        if (document.getElementById("lp"+player+i).innerHTML == "") {
                            var rand = Math.floor(Math.random()*litereramaseinsac);
                            console.log(rand);
                            document.getElementById("lp"+player+i).innerHTML = saculetculitere[rand];
                            saculetculitere.remove(rand,rand);
                            litereramaseinsac = litereramaseinsac - 1;
                        }
                    }
                }
            }
        </script>
        <script>
            randomlettersofdoom(1);
            randomlettersofdoom(2);
        </script>
        <div id="calcularepunctaj">
                
            <script> //functia de verificare a corectitudinii tabelei si de actualizare a punctajelor!!!!!!
            //de asemenea si functia de verificare daca s-a castigat
                function winningconditions(){
                    if (gamewon == 1)
                        alert("Jocul s-a incheiat deja!");
                    else{
                        var i;
                        var ok = 1;
                        for (i = 1; i < 8; i++)
                            if (document.getElementById("lp1"+i).innerHTML != "") {
                                ok = 0;
                                break;
                            }
                        if (ok == 1){
                            gamewon = 1;
                            alert("Player 1 a castigat!");
                        }
                        else{
                            var ok2 = 1;
                            for (i = 1; i < 8; i++)
                                if (document.getElementById("lp2"+i).innerHTML != "") {
                                    ok2 = 0;
                                    break;
                                }
                            if (ok2 == 1){
                                gamewon = 1;
                                alert("Player 2 a castigat!");
                            }
                        }
                    }
                }

                function verify(){
                        
                    var alfabet = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "L", "M", "N", "O", "P", "R", "S", "T", "U", "V", "X", "Z"];
                    var punctaj = [1, 9, 1, 2, 1, 8, 9, 10, 1, 10, 1, 4, 1, 1, 2, 1, 1, 1, 1, 8, 10, 10]
                    var i;
                    var j;
                    var ok = 1;
                    var punctaj_player1 = parseInt(document.getElementById("punctaj_player1").innerHTML);
                    var punctaj_player2 = parseInt(document.getElementById("punctaj_player2").innerHTML);
                        
                    var letters_restore = [];
                    var arrayrestore = [];
                    for (i = 1; i < 16; i++)
                        for (j = 1; j < 16; j++)
                            arrayrestore = arrayrestore.concat(document.getElementById("c"+i+j).innerHTML);
                    for (i = 1; i < 8; i++)
                        letters_restore = letters_restore.concat(document.getElementById("lp"+playerturn+i).innerHTML);

                    var punctajpartial = 0;
                    var multiplicator = 1;
                    var cuvinteadaugate = [];

                    //verificare pe linii
                    for (i=1; i<16; i++) {
                        var cuvantnou = "";
                        for (j=1; j<16; j++) {
                            var x = document.getElementById("c"+i+j).innerHTML;
                            if (x != "") {
                                cuvantnou = cuvantnou + x;
                                var culoare = document.getElementById("c"+i+j).getAttribute("style");
                                if (culoare == "")
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x.innerHTML)];
                                if (culoare == "background-color:#f4cecd") {
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x.innerHTML)];
                                    multiplicator = multiplicator * 2;
                                }
                                if (culoare == "background-color:#66c9") {
                                    punctajpartial = punctajpartial + 3*punctaj[alfabet.indexOf(x.innerHTML)];
                                }
                                if (culoare == "background-color:#ee3940") {
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x.innerHTML)];
                                    multiplicator = multiplicator * 3;
                                }
                                if (culoare == "background-color:#b8cc69") {
                                    punctajpartial = punctajpartial + 2*punctaj[alfabet.indexOf(x.innerHTML)];
                                }               
                            }
                            if (x == "" && cuvantnou != "" && cuvantnou.length > 1) {
                                if (cuvintedepetabela.indexOf(cuvantnou) == -1) {
                                    var response;
                                    $.ajax({
                                        url: 'http://172.24.123.76/hackathon-final-webdev/Scrabble-Online/public/php/verifica_cuvant.php?cuvant='+cuvantnou,
                                        method:'get',
                                        success: function(transport) {
                                        response = parseInt(transport,10) || 0;
                                        // alert("Success! \n\n" + response);
                                        },
                                        failure: function() { alert('Something went wrong...'); }
                                    });
                                    if (response != 0) {
                                        cuvinteadaugate = cuvinteadaugate.concat(cuvantnou);
                                        cuvantnou = "";
                                        if (playerturn == 1)
                                            punctaj_player1 = punctaj_player1 + punctajpartial * multiplicator;
                                        else
                                            punctaj_player2 = punctaj_player2 + punctajpartial * multiplicator;
                                        multiplicator = 1;
                                        punctajpartial = 0;
                                    }
                                    else
                                        ok = 0;
                                }
                            }
                        }
                    }

                    //verificare pe coloane
                    for (i=1; i<16; i++) {
                        var cuvantnou = "";
                        for (j=1; j<16; j++) {
                            var x = document.getElementById("c"+j+i).innerHTML;
                            if (x != "") {
                                cuvantnou = cuvantnou + x;
                                var culoare = document.getElementById("c"+j+i).getAttribute("style");
                                if (culoare == "")
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x.innerHTML)];
                                if (culoare == "background-color:#f4cecd") {
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x.innerHTML)];
                                    multiplicator = multiplicator * 2;
                                }
                                if (culoare == "background-color:#66c9") {
                                    punctajpartial = punctajpartial + 3*punctaj[alfabet.indexOf(x.innerHTML)];
                                }
                                if (culoare == "background-color:#ee3940") {
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x.innerHTML)];
                                    multiplicator = multiplicator * 3;
                                }
                                if (culoare == "background-color:#b8cc69") {
                                    punctajpartial = punctajpartial + 2*punctaj[alfabet.indexOf(x.innerHTML)];
                                }               
                            }
                            if (x == "" && cuvantnou != "" && cuvantnou.length > 1) {
                                if (cuvintedepetabela.indexOf(cuvantnou) == -1) {
                                    var response;
                                    $.ajax({
                                        url: 'http://172.24.123.76/hackathon-final-webdev/Scrabble-Online/public/php/verifica_cuvant.php?cuvant='+cuvantnou,
                                        method:'get',
                                        success: function(transport) {
                                        response = parseInt(transport,10) || 0;
                                        // alert("Success! \n\n" + response);
                                        },
                                        failure: function() { alert('Something went wrong...'); }
                                    });
                                    if (response != 0) {
                                        cuvinteadaugate = cuvinteadaugate.concat(cuvantnou);
                                        cuvantnou = "";
                                        if (playerturn == 1)
                                            punctaj_player1 = punctaj_player1 + punctajpartial * multiplicator;
                                        else
                                            punctaj_player2 = punctaj_player2 + punctajpartial * multiplicator;
                                        multiplicator = 1;
                                        punctajpartial = 0;
                                    }
                                    else
                                        ok = 0;
                                }
                            }
                        }
                    }

                    if (cuvinteadaugate.length == 0)
                        ok = 0;

                    if (ok == 0) { //revenim la starea initiala
                        var i;
                        var j;
                        var k = 0;
                        for (i = 1; i < 16; i++)
                            for (j = 1; j < 16; j++)
                                document.getElementById("c"+i+j).innerHTML = arrayrestore[k++];
                        k = 0;
                        for (i = 1; i < 8; i++)
                            document.getElementById("lp"+playerturn+i).innerHTML = letters_restore[k++];
                        alert("Ai grija la ce introduci!");
                    }
                    else {
                        cuvintedepetabela = cuvintedepetabela.concat(cuvinteadaugate);
                        if (playerturn == 1)
                            document.getElementById("punctaj_player1").innerHTML = punctaj_player1;
                        else
                            document.getElementById("punctaj_player2").innerHTML = punctaj_player2;
                        playerturn = 3 - playerturn;
                        randomlettersofdoom(3 - playerturn);
                        winningconditions();
                    }
                }
            </script>
        </div>    
        <br>
        <br>
        <center><form><input type="button" name="Verificare" value="Verificare" onclick="verify()"></form></center>
    </body>
</html>
