<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Scrabble Online</title>
      	<script src="js/functions.js" type="text/javascript"></script>
      	<script src="http://code.jquery.com/jquery.min.js" type="text/javascript"></script>
      	<link href='http://fonts.googleapis.com/css?family=Elsie+Swash+Caps' rel='stylesheet' type='text/css'>

        <style>
        	body {
        		background-color: #ffffff;
                background-image:url(images/bg.jpg);
                background-repeat: repeat;
        		font-family: Tahoma, Arial;
        		font-size:15px;
        	}
        	#wrap {
        		margin:0 auto;
        		width:950px;
        	}
        	#table td {
        		border:1px solid #333333;
                width:30px;
                height:30px;
                font-family: 'Elsie Swash Caps', cursive;
        	}

            .litera {
                font-family: 'Elsie Swash Caps', cursive;
                background-image:url(images/darker.png);
                background-position: center center;
                padding-top:3px;
                font-size:20px;
                width:30px;
                height:27px;
                margin-bottom:5px;
                text-align: center;
                -moz-border-radius:5px;
                border-radius: 5px;
                border:2px solid #7e2e1f;
            }

        	#table {
        		border:1px solid #333333;
        		text-align:center;
        		margin-right: 10px;
        	}
        	#joc {
        		float:left;
        		width:530px;
        		margin-right: 10px;
        	}
        	#player1 {
        		float:left;
        		width:200px;
        		margin-right: 10px;
        	}
        	#player2 {
        		float:left;
        		width:200px;
        	}
        	#verif {
                font-family: 'Elsie Swash Caps', cursive;
        		font-size: 30px;
        		margin: 0 auto;
        		margin-bottom: 20px;
        		-moz-border-radius: 5px;
        		border-radius: 5px;
        		width: 200px;
        		position: relative;
        		left: -20px;
        	}
        </style>
        <!-- Drag and drop -->
        <script>
            function allowDrop(ev){
                ev.preventDefault();
            }

            function drag(ev){
                ev.dataTransfer.setData("Text", ev.target.id);
            }

            function drop(ev){
                ev.preventDefault();
                var data = ev.dataTransfer.getData("Text");
                ev.target.innerHTML = document.getElementById(data).innerHTML;
                document.getElementById(data).innerHTML = "";
            }
        </script>
    </head>
    <body>
        <div align="center"><form><input id = "verif" type="button" name="Verificare" value="Verificare" onclick="verify()"></form></div>
        <script>
            
            Array.prototype.remove = function(from, to) {
                var rest = this.slice((to || from) + 1 || this.length);
                this.length = from < 0 ? this.length + from : from;
                return this.push.apply(this, rest);
            };

            var saculetculitere = ["A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "B", "B",
                                    "C", "C", "C", "C", "C", "D", "D", "D", "D", "E", "E", "E", "E",
                                    "E", "E", "E", "E", "E", "F", "F", "G", "G", "H", "I", "I", "I",
                                    "I", "I", "I", "I", "I", "I", "I", "J", "L", "L", "L", "L", "M",
                                    "M", "M", "N", "N", "N", "N", "N", "N", "O", "O", "O", "O", "O",
                                    "P", "P", "P", "P", "R", "R", "R", "R", "R", "R", "R", "S", "S",
                                    "S", "S", "S", "T", "T", "T", "T", "T", "T", "T", "U", "U", "U",
                                    "U", "U", "U", "V", "V", "X", "Z"];
            var litereramaseinsac = 98;
            var playerturn = 1;
            var cuvintedepetabela = [];
            var gamewon = 0;

            var arrayrestore = [];
            var lp1restore = [];
            var lp2restore = [];
        </script>

	    <div id="wrap">
		    <div id="player1">
		    	<h3>Player 1</h3>
		    	<div id="letters_player1">
		    		<div id="lp11" class="litera" draggable="true" ondragstart="drag(event)"></div>
		    		<div id="lp12" class="litera" draggable="true" ondragstart="drag(event)"></div>
		    		<div id="lp13" class="litera" draggable="true" ondragstart="drag(event)"></div>
		    		<div id="lp14" class="litera" draggable="true" ondragstart="drag(event)"></div>
		    		<div id="lp15" class="litera" draggable="true" ondragstart="drag(event)"></div>
                    <div id="lp16" class="litera" draggable="true" ondragstart="drag(event)"></div>
                    <div id="lp17" class="litera" draggable="true" ondragstart="drag(event)"></div>
		    	</div>
                <br>
                <div id="punctaj_player1">0</div>
		    </div>
	    	<div id="joc">
		        <script>
					var table_size = 16;
					var style = '';
					var seccond_diag = 16;
					var letter = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
					document.write('<table id="table" border="0" style="" cellpadding="0" cellspacing="0">');
					for(var i = 1; i < table_size; i++){ 
						document.write('<tr id="r' + i + '">');
						for(var j = 1; j < table_size; j++){
							do_colors();
							document.write('<td id="c'+ i + "_" + j +'" ondrop="drop(event)" ondragover="allowDrop(event)" style="' + style + '"></td>');
							style = '';
						}
						document.write("</tr>");
					}
					document.write("</table>");
		        </script>
		    </div>

		    <div id="player2">
		    	<h3>Player 2</h3>
                <div id="letters_player2">
                    <div id="lp21" class="litera" draggable="true" ondragstart="drag(event)"></div>
                    <div id="lp22" class="litera" draggable="true" ondragstart="drag(event)"></div>
                    <div id="lp23" class="litera" draggable="true" ondragstart="drag(event)"></div>
                    <div id="lp24" class="litera" draggable="true" ondragstart="drag(event)"></div>
                    <div id="lp25" class="litera" draggable="true" ondragstart="drag(event)"></div>
                    <div id="lp26" class="litera" draggable="true" ondragstart="drag(event)"></div>
                    <div id="lp27" class="litera" draggable="true" ondragstart="drag(event)"></div>
                </div>
            <br>
            <div id="punctaj_player2">0</div>
		    </div>
		    <br style="clear:both;">
   		</div>
        <script>
            function randomlettersofdoom(player){ //functie pentru adaugare de litere random pe placuta cu litere a jucatorilor; player poate fi 1 sau 2
                if (litereramaseinsac != 0) {
                    var i;
                    for (i = 1; i < 8; i++) {
                        if (litereramaseinsac == 0)
                            break;
                        var rand = Math.floor(Math.random()*litereramaseinsac);
                        console.log(rand);
                        if (document.getElementById("lp"+player+i).innerHTML == "") {
                            var rand = Math.floor(Math.random()*litereramaseinsac);
                            console.log(rand);
                            document.getElementById("lp"+player+i).innerHTML = saculetculitere[rand];
                            saculetculitere.remove(rand,rand);
                            litereramaseinsac = litereramaseinsac - 1;
                        }
                    }
                }
            }
        </script>
        <script>
            randomlettersofdoom(1);
            randomlettersofdoom(2);
        </script>
        <div id="calcularepunctaj">
                
            <script> //functia de verificare a corectitudinii tabelei si de actualizare a punctajelor!!!!!!
            //de asemenea si functia de verificare daca s-a castigat
                function winningconditions(){
                    if (gamewon == 1)
                        alert("Jocul s-a incheiat deja!");
                    else{
                        var i;
                        var ok = 1;
                        for (i = 1; i < 8; i++)
                            if (document.getElementById("lp1"+i).innerHTML != "") {
                                ok = 0;
                                break;
                            }
                        if (ok == 1){
                            gamewon = 1;
                            alert("Player 1 a castigat!");
                        }
                        else{
                            var ok2 = 1;
                            for (i = 1; i < 8; i++)
                                if (document.getElementById("lp2"+i).innerHTML != "") {
                                    ok2 = 0;
                                    break;
                                }
                            if (ok2 == 1){
                                gamewon = 1;
                                alert("Player 2 a castigat!");
                            }
                        }
                    }
                }

                function restore() {

                    arrayrestore = [];
                    lp1restore = [];
                    lp2restore = [];
                    for (var i = 1; i < 16; i++)
                        for (var j = 1; j < 16; j++)
                            arrayrestore = arrayrestore.concat(document.getElementById("c"+i+"_"+j).innerHTML);
                    console.log(arrayrestore);
                    for (i = 1; i < 8; i++) {
                        lp1restore = lp1restore.concat(document.getElementById("lp1"+i).innerHTML);
                        lp2restore = lp2restore.concat(document.getElementById("lp2"+i).innerHTML);
                    }

                }

                function verify(){

                    var alfabet = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "L", "M", "N", "O", "P", "R", "S", "T", "U", "V", "X", "Z"];
                    var punctaj = [1, 9, 1, 2, 1, 8, 9, 10, 1, 10, 1, 4, 1, 1, 2, 1, 1, 1, 1, 8, 10, 10]
                    var i;
                    var j;
                    var ok = 1;
                    var punctaj_player1 = parseInt(document.getElementById("punctaj_player1").innerHTML);
                    var punctaj_player2 = parseInt(document.getElementById("punctaj_player2").innerHTML);
                        
                    

                    var punctajpartial = 0;
                    var multiplicator = 1;
                    var cuvinteadaugate = [];

                    //verificare pe linii
                    for (i=1; i<16; i++) {
                        punctajpartial = 0;
                        multiplicator = 1;
                        var cuvantnou = "";
                        for (j=1; j<16; j++) {
                            var x = document.getElementById("c"+i+"_"+j).innerHTML;
                            if (x != "" && x!= undefined) {
                                cuvantnou = cuvantnou + x;
                                var culoare = document.getElementById("c"+i+"_"+j).getAttribute("style");
                                if (culoare == "")
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x)];
                                if (culoare == "background-color:#f4cecd") { //roz
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x)];
                                    multiplicator = multiplicator * 2;
                                }
                                if (culoare == "background-color:#66c9") { //albastru
                                    punctajpartial = punctajpartial + 3*punctaj[alfabet.indexOf(x)];
                                }
                                if (culoare == "background-color:#ee3940") { //rosu
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x)];
                                    multiplicator = multiplicator * 3;
                                }
                                if (culoare == "background-color:#b8cc69") { //verde
                                    punctajpartial = punctajpartial + 2*punctaj[alfabet.indexOf(x)];
                                }               
                            }
                            if ((x == "" || x == undefined) && cuvantnou != "" && cuvantnou.length > 1) {
                                if (cuvintedepetabela.indexOf(cuvantnou) == -1) {
                                    var response;
                                    $.ajax({
                                        url: 'http://172.24.123.76/hackathon-final-webdev/Scrabble-Online/public/php/verifica_cuvant.php?cuvant='+cuvantnou,
                                        method:'get',
                                        success: function(transport) {
                                        response = parseInt(transport,10) || 0;
                                        // alert("Success! \n\n" + response);
                                        },
                                        failure: function() { alert('Something went wrong...'); }
                                    });
                                    if (response != 0) {
                                        cuvinteadaugate = cuvinteadaugate.concat(cuvantnou);
                                        cuvantnou = "";
                                        if (playerturn == 1)
                                            punctaj_player1 = punctaj_player1 + punctajpartial * multiplicator;
                                        else
                                            punctaj_player2 = punctaj_player2 + punctajpartial * multiplicator;
                                        multiplicator = 1;
                                        punctajpartial = 0;
                                    }
                                    else{
                                        ok = 0;
                                        multiplicator = 1;
                                        punctajpartial = 0;
                                        cuvantnou = "";
                                    }
                                }
                                else{  
                                    multiplicator = 1;
                                    punctajpartial = 0;
                                    cuvantnou = "";
                                }
                            }
                        }
                    }

                    punctajpartial = 0;
                    multiplicator = 1;

                    //verificare pe coloane
                    for (i=1; i<16; i++) {
                        punctajpartial = 0;
                        multiplicator = 1;
                        var cuvantnou = "";
                        for (j=1; j<16; j++) {
                            var x = document.getElementById("c"+j+"_"+i).innerHTML;
                            if (x != "" && x!= undefined) {
                                cuvantnou = cuvantnou + x;
                                var culoare = document.getElementById("c"+j+"_"+i).getAttribute("style");
                                if (culoare == "")
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x)];
                                if (culoare == "background-color:#f4cecd") { //roz
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x)];
                                    multiplicator = multiplicator * 2;
                                }
                                if (culoare == "background-color:#66c9") {  //albastru
                                    punctajpartial = punctajpartial + 3*punctaj[alfabet.indexOf(x)];
                                }
                                if (culoare == "background-color:#ee3940") { //rosu
                                    punctajpartial = punctajpartial + punctaj[alfabet.indexOf(x)];
                                    multiplicator = multiplicator * 3;
                                }
                                if (culoare == "background-color:#b8cc69") { //verde
                                    punctajpartial = punctajpartial + 2*punctaj[alfabet.indexOf(x)];
                                }               
                            }
                            if ((x == "" || x== undefined) && cuvantnou != "" && cuvantnou.length > 1) {
                                if (cuvintedepetabela.indexOf(cuvantnou) == -1) {
                                    console.log(cuvantnou);
                                    var response;
                                    $.ajax({
                                        url: 'http://172.24.123.76/hackathon-final-webdev/Scrabble-Online/public/php/verifica_cuvant.php?cuvant='+cuvantnou,
                                        method:'get',
                                        success: function(transport) {
                                        response = parseInt(transport,10) || 0;
                                        // alert("Success! \n\n" + response);
                                        },
                                        failure: function() { alert('Something went wrong...'); }
                                    });
                                    if (response != 0) {
                                        cuvinteadaugate = cuvinteadaugate.concat(cuvantnou);
                                        cuvantnou = "";
                                        if (playerturn == 1)
                                            punctaj_player1 = punctaj_player1 + punctajpartial * multiplicator;
                                        else
                                            punctaj_player2 = punctaj_player2 + punctajpartial * multiplicator;
                                        multiplicator = 1;
                                        punctajpartial = 0;
                                    }
                                    else{
                                        ok = 0;
                                        multiplicator = 1;
                                        punctajpartial = 0;
                                        cuvantnou = "";
                                    };
                                }
                                else{  
                                    multiplicator = 1;
                                    punctajpartial = 0;
                                    cuvantnou = "";
                                }
                            }
                        }
                    }

                    if (cuvinteadaugate.length == 0)
                        ok = 0;

                    if (ok == 0) { //revenim la starea initiala
                        var i;
                        var j;
                        var k = 0;
                        for (i = 1; i < 16; i++)
                            for (j = 1; j < 16; j++) {
                                if (arrayrestore[k] != undefined)
                                    document.getElementById("c"+i+"_"+j).innerHTML = arrayrestore[k++];
                                else 
                                    document.getElementById("c"+i+"_"+j).innerHTML = "";
                                console.log(arrayrestore[k-1]);
                        }
                        k = 0;
                        for (i = 1; i < 8; i++) {
                            document.getElementById("lp1"+i).innerHTML = lp1restore[i-1];
                            document.getElementById("lp2"+i).innerHTML = lp2restore[i-1];
                            console.log("ok");
                        }
                        alert("Ai grija la ce introduci!");
                    }
                    else {

                        for (i = 1; i < 16; i++)
                            for (j = 1; j < 16; j++)
                                    arrayrestore = arrayrestore.concat(document.getElementById("c"+i+"_"+j).innerHTML);
                        cuvintedepetabela = cuvintedepetabela.concat(cuvinteadaugate);
                        if (playerturn == 1)
                            document.getElementById("punctaj_player1").innerHTML = punctaj_player1;
                        else
                            document.getElementById("punctaj_player2").innerHTML = punctaj_player2;
                        playerturn = 3 - playerturn;
                        randomlettersofdoom(3 - playerturn);
                        winningconditions();
                        restore();
                    }
                }
            </script>
        </div>    
        <br>
        <br>
        <script>
            restore();
        </script>
    </body>
</html>
